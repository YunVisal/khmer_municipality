<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Go Webpage</title>
</head>
<body>
    <h1>Welcome to my Go-hosted website!</h1>
    <p>This is a simple webpage served using Go.</p>

    <script>
        const tokenExpiredTime = localStorage.getItem("expired_time");
        if(!tokenExpiredTime) {
            window.location.replace("https://www.dropbox.com/oauth2/authorize?client_id=h3dwgmhxu6562f6&response_type=token&redirect_uri=http://localhost:8080/token/");
        }

        const now = new Date();
        if(now.getTime() > parseInt(tokenExpiredTime)){
            window.location.replace("https://www.dropbox.com/oauth2/authorize?client_id=h3dwgmhxu6562f6&response_type=token&redirect_uri=http://localhost:8080/token/");
        }

        function getFiles() {
            const accessToken = localStorage.getItem("access_token");
            const tokenType = localStorage.getItem("token_type");
            fetch("https://api.dropboxapi.com/2/files/list_folder", {headers: {Authorization: `${tokenType} ${accessToken}`, "Content-Type": "application/json"}, method: "POST", body: JSON.stringify({
                "include_deleted":false,
                "include_has_explicit_shared_members":false,
                "include_media_info":false,
                "include_mounted_folders":true,
                "include_non_downloadable_files":true,
                "recursive":false, 
                "path": "/khmer_municipality_upload"
            })}).then(function(res) {res.json()}).then(function(data) {console.log(data)}).catch(function(e) {console.error(e)})
        }
        getFiles()
    </script>
</body>
</html>
